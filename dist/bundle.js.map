{"version":3,"file":"bundle.js","sources":["../src/audioDetection.js","../src/cake.js","../src/app.js"],"sourcesContent":["export class AudioDetection {\n  constructor(config) {\n    this.audioContext = null;\n    this.meter = null;\n    this.debuglog = false;\n    this.config = config;\n  }\n\n  async init() {\n    window.AudioContext = window.AudioContext || window.webkitAudioContext;\n    this.audioContext = new AudioContext();\n\n    document.addEventListener(\"click\", () => {\n      this.audioContext.resume();\n    });\n\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: {\n          mandatory: {\n            googEchoCancellation: \"false\",\n            googAutoGainControl: \"false\",\n            googNoiseSuppression: \"false\",\n            googHighpassFilter: \"false\",\n          },\n          optional: [],\n        },\n      });\n      return this.handleStream(stream);\n    } catch (e) {\n      console.error(\"getUserMedia threw exception:\", e);\n      throw e;\n    }\n  }\n\n  handleStream(stream) {\n    const source = this.audioContext.createMediaStreamSource(stream);\n    this.meter = this.createAudioMeter(this.audioContext);\n    source.connect(this.meter);\n    return this.meter;\n  }\n\n  createAudioMeter(audioContext) {\n    const processor = audioContext.createScriptProcessor(2048, 1, 1);\n    const meter = {\n      volume: 0,\n      checkClipping: () => false,\n      processor: processor,\n    };\n\n    processor.onaudioprocess = (e) => {\n      const input = e.inputBuffer.getChannelData(0);\n      let sum = 0;\n      for (let i = 0; i < input.length; i++) {\n        sum += input[i] * input[i];\n      }\n      meter.volume = Math.sqrt(sum / input.length);\n    };\n\n    processor.connect(audioContext.destination);\n    return meter;\n  }\n\n  setDebugMode(enabled) {\n    this.debuglog = enabled;\n  }\n}\n","export class Cake {\n  constructor(container) {\n    this.container = container;\n    this.cakeElement = null;\n    this.flameElement = null;\n    this.isBlown = false;\n  }\n\n  init() {\n    this.cakeElement = document.createElement(\"div\");\n    this.cakeElement.className = \"cake\";\n    this.createCakeLayers();\n    this.createCandle();\n    this.container.appendChild(this.cakeElement);\n  }\n\n  createCakeLayers() {\n    const layers = [\"top\", \"middle\", \"bottom\"];\n    layers.forEach((layer) => {\n      const layerElement = document.createElement(\"div\");\n      layerElement.className = `layer layer-${layer}`;\n      this.cakeElement.appendChild(layerElement);\n    });\n\n    const icing = document.createElement(\"div\");\n    icing.className = \"icing\";\n    this.cakeElement.appendChild(icing);\n\n    // Add decorations\n    for (let i = 1; i <= 7; i++) {\n      const decoration = document.createElement(\"div\");\n      decoration.className = `decoration decoration${i}`;\n      this.cakeElement.appendChild(decoration);\n    }\n  }\n\n  createCandle() {\n    const candle = document.createElement(\"div\");\n    candle.className = \"candle\";\n    this.cakeElement.appendChild(candle);\n\n    this.flameElement = document.createElement(\"div\");\n    this.flameElement.className = \"flame\";\n    candle.appendChild(this.flameElement);\n  }\n\n  blowOut() {\n    if (this.isBlown) return;\n\n    this.isBlown = true;\n    this.flameElement.style.opacity = \"0\";\n    this.flameElement.style.transform = \"scale(0)\";\n\n    // Trigger confetti\n    if (typeof confetti !== \"undefined\") {\n      confetti({\n        particleCount: 100,\n        spread: 70,\n        origin: { y: 0.6 },\n      });\n    }\n  }\n\n  reset() {\n    this.isBlown = false;\n    this.flameElement.style.opacity = \"1\";\n    this.flameElement.style.transform = \"scale(1)\";\n  }\n}\n","import { AudioDetection } from \"./audioDetection.js\";\nimport { Cake } from \"./cake.js\";\n\nexport class BirthdayApp {\n  constructor() {\n    this.audioDetection = new AudioDetection();\n    this.cake = null;\n    this.isInitialized = false;\n  }\n\n  async init() {\n    if (this.isInitialized) return;\n\n    const container = document.getElementById(\"cake-container\");\n    if (!container) {\n      console.error(\"Cake container not found\");\n      return;\n    }\n\n    this.cake = new Cake(container);\n    this.cake.init();\n\n    try {\n      const meter = await this.audioDetection.init();\n      this.startVolumeMonitoring(meter);\n      this.isInitialized = true;\n    } catch (error) {\n      console.error(\"Failed to initialize audio:\", error);\n      this.showError(\"Microphone access is required for this demo.\");\n    }\n  }\n\n  startVolumeMonitoring(meter) {\n    const checkVolume = () => {\n      if (!this.cake || this.cake.isBlown) return;\n\n      const volume = meter.volume;\n      if (volume > 0.15) {\n        // Threshold for blowing detection\n        this.cake.blowOut();\n      }\n\n      requestAnimationFrame(checkVolume);\n    };\n\n    checkVolume();\n  }\n\n  showError(message) {\n    const errorDiv = document.createElement(\"div\");\n    errorDiv.className = \"error-message\";\n    errorDiv.textContent = message;\n    document.body.appendChild(errorDiv);\n  }\n\n  reset() {\n    if (this.cake) {\n      this.cake.reset();\n    }\n  }\n}\n"],"names":["AudioDetection","constructor","config","this","audioContext","meter","debuglog","init","window","AudioContext","webkitAudioContext","document","addEventListener","resume","stream","navigator","mediaDevices","getUserMedia","audio","mandatory","googEchoCancellation","googAutoGainControl","googNoiseSuppression","googHighpassFilter","optional","handleStream","e","console","error","source","createMediaStreamSource","createAudioMeter","connect","processor","createScriptProcessor","volume","checkClipping","onaudioprocess","input","inputBuffer","getChannelData","sum","i","length","Math","sqrt","destination","setDebugMode","enabled","Cake","container","cakeElement","flameElement","isBlown","createElement","className","createCakeLayers","createCandle","appendChild","forEach","layer","layerElement","icing","decoration","candle","blowOut","style","opacity","transform","confetti","particleCount","spread","origin","y","reset","audioDetection","cake","isInitialized","getElementById","startVolumeMonitoring","showError","checkVolume","requestAnimationFrame","message","errorDiv","textContent","body"],"mappings":"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"}